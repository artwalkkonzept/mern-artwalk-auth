(this["webpackJsonpreact-using-auth-api"]=this["webpackJsonpreact-using-auth-api"]||[]).push([[0],{16:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(6),c=n.n(a),s=n(2),o=n.n(s),i=n(4),u=n(3),l=n(9),p=n(7),h=n(8),j=function(){function e(t){Object(p.a)(this,e),this.auth_api_url=t}return Object(h.a)(e,[{key:"login",value:function(){var e=Object(i.a)(o.a.mark((function e(t,n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.auth_api_url,{method:"POST",body:JSON.stringify({username:t,password:n})});case 2:return r=e.sent,e.next=5,r.json();case 5:if(a=e.sent,![401,404].includes(parseInt(r.status))){e.next=8;break}throw Error(a.msg);case 8:return this.setToken(a.token),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loggedIn",value:function(){return null!==this.getToken()}},{key:"setToken",value:function(e){localStorage.setItem("token",e)}},{key:"getToken",value:function(){return localStorage.getItem("token")}},{key:"logout",value:function(){localStorage.removeItem("token")}},{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var n={Accept:"application/json","Content-Type":"application/json"};return this.loggedIn()&&(n.Authorization="Bearer ".concat(this.getToken())),fetch(e,Object(l.a)({headers:n},t))}))}]),e}(),g=j,b=n(0);var f=function(e){var t=Object(r.useState)(""),n=Object(u.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(""),o=Object(u.a)(s,2),i=o[0],l=o[1];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h3",{children:"Login"}),Object(b.jsx)("input",{onChange:function(e){return c(e.target.value)},name:"username",type:"text",placeholder:"username"}),Object(b.jsx)("br",{}),Object(b.jsx)("input",{onChange:function(e){return l(e.target.value)},name:"password",type:"password",placeholder:"password"}),Object(b.jsx)("br",{}),Object(b.jsx)("button",{onClick:function(){e.login(a,i)},children:"Login"})]})},d="http://localhost:8080/api",O=new g("".concat(d,"/users/authenticate"));var x=function(){var e=Object(r.useState)([]),t=Object(u.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(0),s=Object(u.a)(c,2),l=s[0],p=s[1];function h(){return(h=Object(i.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.login(t,n);case 3:r=e.sent,console.log("Authentication:",r.msg),p(l+1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Login",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}Object(r.useEffect)((function(){function e(){return(e=Object(i.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(d,"/artwalks"),e.next=3,O.fetch(t);case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,a(r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[l]);var j=Object(b.jsx)("p",{children:"No artwalks!"});return n.length>0&&(j=Object(b.jsx)("ol",{children:n.map((function(e){return Object(b.jsxs)("li",{children:[e.name,", ",e.bilds]},e.id)}))})),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h1",{children:"Artwalks"}),j,Object(b.jsx)(f,{login:function(e,t){return h.apply(this,arguments)}}),O.loggedIn()?Object(b.jsx)("pre",{children:"User is logged in"}):Object(b.jsx)("pre",{children:"User is not logged in"})]})};c.a.render(Object(b.jsx)(x,{}),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.a44219e6.chunk.js.map